<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>간단 공문 내용 생성기</title>
    <style>
        body {
            font-family: 'Malgun Gothic', '맑은 고딕', sans-serif;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            flex-wrap: wrap; /* 창이 작을 때 세로로 배치 */
            padding: 20px;
            background-color: #f4f4f4;
            gap: 20px;
        }
        .container {
            width: 100%;
            max-width: 700px;
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            flex-shrink: 0;
        }
        h1, h2 {
            text-align: center;
            color: #333;
        }
        .input-form .form-group {
            margin-bottom: 20px;
        }
        .input-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        .input-form input[type="text"],
        .input-form input[type="date"],
        .input-form input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .related-inputs, .content-composer {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        .related-inputs input[type="text"], .related-inputs input[type="date"] {
            flex: 1;
        }
        .content-composer input:first-child { flex: 1; }
        .content-composer input:last-child { flex: 2; }
        .preset-buttons {
            margin-top: 8px;
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        .preset-btn {
            padding: 5px 10px;
            border: 1px solid #007bff;
            background-color: #fff;
            color: #007bff;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .preset-btn:hover {
            background-color: #007bff;
            color: #fff;
        }
        #preview {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #ddd;
            background-color: #f9f9f9;
            min-height: 350px;
            white-space: pre-wrap;
            font-size: 16px;
            line-height: 1.8;
            font-family: 'Batang', '바탕', serif;
        }
        #copy-button {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        #copy-button:hover {
            background-color: #218838;
        }
        #copy-feedback {
            text-align: center;
            margin-top: 10px;
            color: green;
            font-weight: bold;
            visibility: hidden;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>간단 공문 내용 생성기</h1>
        <div class="input-form">
            <div class="form-group">
                <label>1. 관련:</label>
                <div class="related-inputs">
                    <input type="text" id="related-org" placeholder="기관이름">
                    <span>-</span>
                    <input type="text" id="related-doc-num" placeholder="문서번호">
                    <input type="date" id="related-date">
                </div>
            </div>
            <div class="form-group">
                <label for="content">2. 내용:</label>
                <div class="content-composer">
                    <input type="text" id="content" placeholder="예: 2025년도 사업 계획">
                    <input type="text" id="endingPhrase" value="을(를) 붙임과 같이 제출합니다.">
                </div>
                <div class="preset-buttons">
                    <button type="button" class="preset-btn" data-phrase="을(를) 붙임과 같이 제출합니다.">제출</button>
                    <button type="button" class="preset-btn" data-phrase="을(를) 붙임과 같이 보고합니다.">보고</button>
                    <button type="button" class="preset-btn" data-phrase="을(를) 붙임과 같이 수립하여 운영하고자 합니다.">계획수립</button>
                    <button type="button" class="preset-btn" data-phrase="을(를) 붙임과 같이 요청합니다.">요청</button>
                </div>
            </div>
            <div class="form-group">
                <label for="attachment">붙임 파일 (여러 개 선택 가능: Ctrl 또는 Shift 키 사용)</label>
                <input type="file" id="attachment" multiple>
            </div>
        </div>
    </div>

    <div class="container">
        <h2>미리보기 및 복사</h2>
        <div id="preview">
            <div id="preview-body"></div>
        </div>
        <button id="copy-button">공문 내용 복사하기</button>
        <div id="copy-feedback">복사되었습니다!</div>
    </div>

<script>
    // 입력 요소
    const relatedOrgInput = document.getElementById('related-org');
    const relatedDocNumInput = document.getElementById('related-doc-num');
    const relatedDateInput = document.getElementById('related-date');
    const contentInput = document.getElementById('content');
    const endingPhraseInput = document.getElementById('endingPhrase');
    const attachmentInput = document.getElementById('attachment');
    const presetBtns = document.querySelectorAll('.preset-btn');

    // 출력 요소
    const previewBody = document.getElementById('preview-body');
    const copyButton = document.getElementById('copy-button');
    const copyFeedback = document.getElementById('copy-feedback');

    function updatePreview() {
        // 1. "관련" 텍스트 생성
        const org = relatedOrgInput.value;
        const docNum = relatedDocNumInput.value;
        const dateVal = relatedDateInput.value;
        
        let formattedDate = '';
        if (dateVal) {
            const dateParts = dateVal.split('-');
            const year = dateParts[0];
            const month = parseInt(dateParts[1], 10); // '0' 제거
            const day = parseInt(dateParts[2], 10);   // '0' 제거
            formattedDate = `(${year}. ${month}. ${day}.)`;
        }

        const mainPart = [org, docNum].filter(Boolean).join('-');
        const relatedText = mainPart + formattedDate;

        // 2. "붙임" 텍스트 생성
        const files = attachmentInput.files;
        let attachmentText = '끝.';

        if (files.length === 1) {
            attachmentText = `${files[0].name} 1부.  끝.`;
        } else if (files.length > 1) {
            let fileList = [];
            for (let i = 0; i < files.length; i++) {
                const endMark = (i === files.length - 1) ? '  끝.' : '';
                fileList.push(`${i + 1}. ${files[i].name} 1부.${endMark}`);
            }
            attachmentText = fileList.join('\n         ');
        }

        // 3. 본문 생성 및 업데이트
        const mainContent = contentInput.value;
        const endingPhrase = endingPhraseInput.value;
        
        let bodyContent = `1. 관련: ${relatedText}\n`;
        bodyContent += `2. ${mainContent}${endingPhrase}\n\n`;
        bodyContent += `붙임  ${attachmentText}`;
        
        previewBody.innerText = bodyContent;
    }

    // 모든 입력 요소에 이벤트 리스너 추가
    const allInputs = [
        relatedOrgInput, relatedDocNumInput, relatedDateInput,
        contentInput, endingPhraseInput, attachmentInput
    ];
    allInputs.forEach(input => {
        input.addEventListener('input', updatePreview);
        input.addEventListener('change', updatePreview); // 날짜 선택기 변경 감지
    });

    // 프리셋 버튼에 이벤트 리스너 추가
    presetBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            endingPhraseInput.value = btn.dataset.phrase;
            updatePreview();
        });
    });

    // 복사 버튼 이벤트 리스너
    copyButton.addEventListener('click', () => {
        const fullTextToCopy = previewBody.innerText;
        
        navigator.clipboard.writeText(fullTextToCopy).then(() => {
            copyFeedback.style.visibility = 'visible';
            setTimeout(() => {
                copyFeedback.style.visibility = 'hidden';
            }, 2000);
        }).catch(err => {
            console.error('복사 실패:', err);
            alert('클립보드 복사에 실패했습니다.');
        });
    });

    // 페이지 로드 시 초기 미리보기 실행
    updatePreview();
</script>

</body>
</html>